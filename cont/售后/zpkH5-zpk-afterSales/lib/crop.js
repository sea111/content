var Crop=function(e){var t,n,a=document.getElementById(e.fileId),i=document.getElementById(e.canvasId),c=new Image,r=new FileReader,d=i.offsetWidth,o=i.offsetHeight,u=1,l=i.getContext("2d");r.onloadend=function(e){c.src=e.target.result,g()};var f=function(e){if(c.complete)return void e.call(c);c.onload=function(){e.call(c)}},s=function(e,a){l.clearRect(0,0,d,o),l.drawImage(c,e,a,n*u,t*u)},g=function(e){f(function(){t=c.height,n=c.width,l.drawImage(c,0,0,n*u,t*u)})},v=function(e){u+=e,l.clearRect(0,0,d,o),l.drawImage(c,0,0,n*u,t*u)},h=function(){return i.toDataURL("image/png")};a.addEventListener("change",function(){if(!/image\/\w+/.test(a.files[0].type))return alert("请选择图片上传!"),!1;r.readAsDataURL(a.files[0])});var m,I,w=0,E=0;return i.addEventListener("touchstart",function(e){var t=e.targetTouches[0];m=t.clientX,I=t.clientY}),i.addEventListener("touchmove",function(e){if(1==e.targetTouches.length){l.clearRect(0,0,750,400),e.preventDefault();var t=e.targetTouches[0];disX=t.clientX-m,disY=t.clientY-I,s(disX+w,disY+E)}}),i.addEventListener("touchend",function(e){w+=disX,E+=disY}),{scale:v,getPicture:h}};