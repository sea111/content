$(function(){function e(e){$.ajax({url:s+"/wpservice/getKey?clientType=5",type:"POST",success:function(n){e&&e(n.data),console.log(n.data)}})}function n(e,n){var a=base64decode(n),r=CryptoJS.enc.Utf8.parse(a);return CryptoJS.AES.encrypt(e,r,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()}function a(e){window.labelCode=c.toString(),$.ajax({type:"POST",url:s+"/wpwl/saleRecord/getById",timeout:1e4,data:{serialNo:n(labelCode,e),versionId:27},success:function(e){if(0==e.success)$(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/error_else.png"),$(".middle p").html("出错了，请稍后再试");else try{if(e.success){var n=e.data;console.log(n),window.isSold=n.isSold,console.log(isSold);var a=n.productUrl,r=n.brandName,t=n.standard,o=n.productName;"yes"==isSold?(consumer=1,l=3,agency=2,i=5):(consumer=1,l=0,agency=2,i=5,i=0,$(".commodity-status").show(),$(".agency-identity").show()),$(".brand-picture img").attr("src",a),$(".brand-name").html(r+"."+o+" "+t),$(".loading").hide()}}catch(e){$(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/error_else.png"),$(".middle p").html("出错了，请稍后再试")}},error:function(e,n,a){"timeout"==n&&($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$(".loadEffect").hide().siblings(".middle").show())}})}function r(e,n){$(e).css({color:"#404040",background:"#fff"}),$(n).css({"border-top":"none",background:"#fff"})}function t(e,n){$(e).css({color:"red",background:"#fee1e5"}),$(n).css({"border-top":"2px solid #fee1e5",background:"#fee1e5"})}function o(){$(".top").css({position:"fixed"}),setTimeout(function(){var e=$(window).scrollTop();$(window).scrollTop(e)},1e3/60)}var s="https://h5.wpwl",c=function(){var e=location.search,n=new Object;if(e.indexOf("?")!=-1){var a=e.substr(1);n=/^(\d+)/.exec(a)[1]}return n}(),l=0,i=0;!function(e){$.ajax({url:s+"/wpwl/getKey?clientType=5",type:"POST",success:function(n){e&&e(n.data)}})}(function(e){a(e)}),$("#wpReload").click(function(){a(keyCode),window.location.reload()}),$(".consumer").click(function(){consumer=1,$(this).css({"border-top":"4px solid #4e9cfc",color:"#4e9cfc",background:"#f2f2f2"}),$(".agency").css({"border-top":"4px solid #fff",color:"#bdbdbd",background:"#fff"}),$("#consumer-content").show(),$("#agency-content").hide()}),$(".agency").click(function(){agency=2,$(this).css({"border-top":"4px solid #4e9cfc",color:"#4e9cfc",background:"#f2f2f2"}),$(".consumer").css({"border-top":"4px solid #fff",color:"#bdbdbd",background:"#fff"}),$("#agency-content").show(),$("#consumer-content").hide()}),$(".finish-install").click(function(){l=3,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".no-install-require").css({background:"#f2f2f2",color:"#bdbdbd"})}),$(".no-install-require").click(function(){l=4,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".finish-install").css({background:"#f2f2f2",color:"#bdbdbd"})}),$(".install-master").click(function(){i=5,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".salesman").css({background:"#f2f2f2",color:"#bdbdbd"})}),$(".salesman").click(function(){i=6,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".install-master").css({background:"#f2f2f2",color:"#bdbdbd"})}),/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&$(".commodity-list").on("focus","input",function(){$(".top").css({position:"absolute"})});var d,u=function(e){this.context=null==e.context?$("body"):e.context,this.message=e.message,this.time=null==e.time?3e3:e.time,this.left=e.left,this.top=e.top,this.init()};u.prototype={init:function(){$("#toastMessage").remove();var e=new Array;e.push('<div id="toastMessage">'),e.push("<span>"+this.message+"</span>"),e.push("</div>"),d=$(e.join("")).appendTo(this.context);var n=null==this.left?this.context.width()/2-d.find("span").width()/2-20:this.left,a=null==this.bottom?"20px":this.bottom;d.css({position:"absolute",bottom:a,"z-index":"99",left:n,"background-color":"black",color:"white","font-size":"12px",padding:"10px",margin:"10px"})},show:function(){d.fadeIn(this.time/2),d.fadeOut(this.time/2)}},$("#get").click(function(){""!=$("#writeNumber").val()&&reg.test($("#writeNumber").val())&&(this.flag||(_t=this,e(function(e){$.ajax({url:s+"/wpservice/device/getDeviceCaptcha",type:"POST",data:{mobile:n($("#writeNumber").val(),e)},success:function(e){}}),_t.flag=!0;var a=60;_t.innerHTML="60秒";var r=setInterval(function(){_t.innerHTML=--a+"秒",0==a&&(clearInterval(r),_t.innerHTML="获取验证码",_t.flag=!1,$("#get").css({color:"#ff7a11"}))},1e3)}),$("#get").css({color:"#404040"}))),o()}),$("#getMessage").click(function(){if(""!=$("#agencyTelephone").val()&&reg.test($("#agencyTelephone").val())&&!this.flag){var a=this;e(function(e){$.ajax({url:s+"/wpservice/device/getDeviceCaptcha",type:"POST",data:{mobile:n($("#agencyTelephone").val(),e)},success:function(e){}}),a.flag=!0;var r=60;a.innerHTML="60秒";var t=setInterval(function(){a.innerHTML=--r+"秒",0==r&&(clearInterval(t),a.innerHTML="获取验证码",a.flag=!1,$("#getMessage").css({color:"#ff7a11"}))},1e3)}),$("#getMessage").css({color:"#404040"})}o()}),window.pattern=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）|{}【】‘；：”“'。，、？]"),window.nameReg=/[\u4e00-\u9fa5a-zA-Z0-9]+$/,window.numReg=/\d+$/,window.numberReg=/^\d+$/,window.reg=/^1[3|4|5|7|8][0-9]{9}$/,window.userErr={},window.agencyErr={},$("#writeName").on("blur",function(e){var n=$("#writeName").val();$("#writeName").attr("realVal",n);var a="writeName";n.length>0&&n.length<=5&&!numReg.test(n)&&nameReg.test(n)&&!pattern.test(n)?(r("#writeName",".name"),a=""):""==n?($("#writeName").val("姓名不能为空"),t("#writeName",".name")):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),t("#writeName",".name")):numReg.test(n)?(new u({context:$("body"),message:"含有数字或长度大于5"}).show(),t("#writeName",".name")):(new u({context:$("body"),message:"姓名至多5个字"}).show(),t("#writeName",".name")),userErr.writeName=a,o()}),$("#writeName").focus(function(){r("#writeName",".name"),$("#writeName").val($("#writeName").attr("realVal")),"姓名不能为空"==$("#writeName").val()&&$("#writeName").val("")}),$("#writeNumber").on("blur",function(e){var n=$("#writeNumber").val();$("#writeNumber").attr("realVal",n);var a="writeNumber";reg.test(n)?(r("#writeNumber",".phonenumber"),a=""):""==n?($("#writeNumber").val("手机号不能为空"),t("#writeNumber",".phonenumber")):(new u({context:$("body"),message:"请填写正确的手机号"}).show(),t("#writeNumber",".phonenumber")),userErr.writeNumber=a,o()}),$("#writeNumber").focus(function(){r("#writeNumber",".phonenumber"),$("#writeNumber").val($("#writeNumber").attr("realVal")),"手机号不能为空"==$("#writeNumber").val()&&$("#writeNumber").val("")}),$("#writeCode").blur(function(){var e="writeCode";$("#writeCode").val().length>6?new u({context:$("body"),message:"长度大于6"}).show():e="",userErr.writeCode=e}),$("#writeAddress").on("blur",function(e){var n=$("#writeAddress").val();$("#writeAddress").attr("realVal",n);var a="writeAddress";n.length>0&&n.length<=30&&!pattern.test(n)?(r("#writeAddress",".address"),a=""):""==n?($("#writeAddress").val(""),r("#writeAddress",".address"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),t("#writeAddress",".address")):(new u({context:$("body"),message:"住址至多30个字"}).show(),t("#writeAddress",".address")),userErr.writeAddress=a,o()}),$("#writeAddress").focus(function(){r("#writeAddress",".address"),$("#writeAddress").val($("#writeAddress").attr("realVal"))}),$("#writeProduct").on("blur",function(e){var n=$("#writeProduct").val();$("#writeProduct").attr("realVal",n);var a="writeProduct";n.length>0&&n.length<=50&&!pattern.test(n)?(r("#writeProduct",".product-model"),a=""):""==n?($("#writeProduct").val(""),r("#writeProduct",".product-model"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符"}).show(),t("#writeProduct",".product-model")):(new u({context:$("body"),message:"产品型号至多50个字"}).show(),t("#writeProduct",".product-model")),userErr.writeProduct=a,o()}),$("#writeProduct").focus(function(){r("#writeProduct",".product-model"),$("#writeProduct").val($("#writeProduct").attr("realVal"))}),$("#writeNum").on("blur",function(e){var n=$("#writeNum").val();$("#writeNum").attr("realVal",n);var a="writeNum";n.length>0&&n.length<=4&&numberReg.test(n)?(r("#writeNum",".number"),a=""):""==n?($("#writeNum").val(""),r("#writeNum",".number"),a=""):(new u({context:$("body"),message:"购买数量至多4个或只能输入数字"}).show(),t("#writeNum",".number")),userErr.writeNum=a,o()}),$("#writeNum").focus(function(){r("#writeNum",".number"),$("#writeNum").val($("#writeNum").attr("realVal"))}),$("#writeMore").on("blur",function(e){var n=$("#writeMore").val();$("#writeMore").attr("realVal",n);var a="writeMore";n.length>0&&n.length<=200&&!pattern.test(n)?(r("#writeMore",".remark"),a=""):""==n?($("#writeMore").val(""),r("#writeMore",".remark"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于200"}).show(),t("#writeMore",".remark")):(new u({context:$("body"),message:"备注至多200个字"}).show(),t("#writeMore",".remark")),userErr.writeMore=a,o()}),$("#writeMore").focus(function(){r("#writeMore",".remark"),$("#writeMore").val($("#writeMore").attr("realVal"))}),$(".submit").click(function(){if(3!==l&&4!==l)new u({context:$("body"),message:"商品状态/你的身份不能为空"}).show();else if(1==consumer&&!$(this).hasClass("disabled")){$("#writeName").blur(),$("#writeNumber").blur(),$("#writeAddress").blur(),$("#writeProduct").blur(),$("#writeNum").blur(),$("#writeMore").blur(),$("#writeCode").blur();var a=!1;for(var r in userErr)userErr[r]&&(a=!0);if(a){new u({context:$("body"),message:"数据有误"}).show();for(var r in userErr)userErr[r]=""}else{var t=$(this);$(this).addClass("disabled");var c={};window.type="","yes"==isSold&&(type="0"),"no"==isSold&&(1==consumer&&4==l?type="1":1==consumer&&3==l&&(type="2")),e(function(e){c=$("#consumer-content:visible").length?{labelCode:n(labelCode,e),consumerName:n($("#writeName").val(),e),consumerMobile:n($("#writeNumber").val(),e),consumerAddress:n($("#writeAddress").val(),e),captcha:n($("#writeCode").val(),e),standard:n($("#writeProduct").val(),e),quantity:n($("#writeNum").val(),e),remark:n($("#writeMore").val(),e),type:n(type,e)}:{labelCode:n(labelCode,e),consumerName:n($("#agencyConsumer").val(),e),consumerMobile:n($("#agencyPhone").val(),e),consumerAddress:n($("#agencyAddress").val(),e),captcha:n($("#agencyMessage").val(),e),sellerName:n($("#agencyName").val(),e),sellerMobile:n($("#agencyTelephone").val(),e),standard:n($("#agencyModel").val(),e),quantity:n($("#agencyNumber").val(),e),remark:n($("#agencyRemark").val(),e),type:n(type,e)},$.ajax({type:"POST",url:s+"/wpservice/device/install29",async:!0,data:c,timeout:1e4,success:function(e){if(t.removeClass("disabled"),e.success)$(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$(".loading").show(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/enterSuccess.png"),$(".middle p").html("登记成功");else{var n=e.errMsg;new u({context:$("body"),message:n}).show()}},error:function(e,n,a){"timeout"==n&&new u({context:$("body"),message:"网络超时"}).show(),t.removeClass("disabled")}})}),o()}}}),$("#agencyConsumer").on("blur",function(e){var n=$("#agencyConsumer").val();$("#agencyConsumer").attr("realVal",n);var a="agencyConsumer";n.length>0&&n.length<=5&&!numReg.test(n)&&nameReg.test(n)&&!pattern.test(n)?(r("#agencyConsumer",".consumer-name"),a=""):""==n?($("#agencyConsumer").val("消费者姓名不能为空"),t("#agencyConsumer",".consumer-name")):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),t("#agencyConsumer",".consumer-name")):numReg.test(n)?(new u({context:$("body"),message:"含有数字符或长度大于5"}).show(),t("#agencyConsumer",".consumer-name")):(new u({context:$("body"),message:"消费者姓名至多5个字"}).show(),t("#agencyConsumer",".consumer-name")),agencyErr.agencyConsumer=a,o()}),$("#agencyConsumer").focus(function(){r("#agencyConsumer",".consumer-name"),$("#agencyConsumer").val($("#agencyConsumer").attr("realVal")),"消费者姓名不能为空"==$("#agencyConsumer").val()&&$("#agencyConsumer").val("")}),$("#agencyPhone").on("blur",function(e){var n=$("#agencyPhone").val();$("#agencyPhone").attr("realVal",n);var a="agencyPhone";reg.test(n)?(r("#agencyPhone",".consumer-phonenumber"),a=""):""==n?($("#agencyPhone").val("消费者手机号不能为空"),t("#agencyPhone",".consumer-phonenumber")):(new u({context:$("body"),message:"请填写正确的手机号"}).show(),t("#agencyPhone",".consumer-phonenumber")),agencyErr.agencyPhone=a,o()}),$("#agencyPhone").focus(function(){r("#agencyPhone",".consumer-phonenumber"),$("#agencyPhone").val($("#agencyPhone").attr("realVal")),"消费者手机号不能为空"==$("#agencyPhone").val()&&$("#agencyPhone").val("")}),$("#agencyAddress").on("blur",function(e){var n=$("#agencyAddress").val();$("#agencyAddress").attr("realVal",n);var a="agencyAddress";n.length>0&&n.length<=30&&!pattern.test(n)?(r("#agencyAddress",".consumer-address"),a=""):""==n?($("#agencyAddress").val(""),r("#agencyAddress",".consumer-address"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于30"}).show(),t("#agencyAddress",".consumer-address")):(new u({context:$("body"),message:"消费者住址至多30个字"}).show(),t("#agencyAddress",".consumer-address")),agencyErr.agencyAddress=a,o()}),$("#agencyAddress").focus(function(){r("#agencyAddress",".consumer-address"),$("#agencyAddress").val($("#agencyAddress").attr("realVal"))}),$("#agencyName").on("blur",function(e){var n=$("#agencyName").val();$("#agencyName").attr("realVal",n);var a="agencyName";n.length>0&&n.length<=5&&!numReg.test(n)&&nameReg.test(n)&&!pattern.test(n)?(r("#agencyName",".agency-name"),a=""):""==n?($("#agencyName").val("您的姓名不能为空"),t("#agencyName",".agency-name")):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),t("#agencyName",".agency-name")):numReg.test(n)?(new u({context:$("body"),message:"含有数字符或长度大于5"}).show(),t("#agencyName",".agency-name")):(new u({context:$("body"),message:"姓名至多5个字"}).show(),t("#agencyName",".agency-name")),agencyErr.agencyName=a,o()}),$("#agencyName").focus(function(){r("#agencyName",".agency-name"),$("#agencyName").val($("#agencyName").attr("realVal")),"您的姓名不能为空"==$("#agencyName").val()&&$("#agencyName").val("")}),$("#agencyTelephone").on("blur",function(e){var n=$("#agencyTelephone").val();$("#agencyTelephone").attr("realVal",n);var a="agencyTelephone";reg.test(n)?(r("#agencyTelephone",".agency-phonenumber"),a=""):""==n?($("#agencyTelephone").val("您的手机号不能为空"),t("#agencyTelephone",".agency-phonenumber")):(new u({context:$("body"),message:"请填写正确的手机号"}).show(),t("#agencyTelephone",".agency-phonenumber")),agencyErr.agencyTelephone=a,o()}),$("#agencyTelephone").focus(function(){r("#agencyTelephone",".agency-phonenumber"),$("#agencyTelephone").val($("#agencyTelephone").attr("realVal")),"您的手机号不能为空"==$("#agencyTelephone").val()&&$("#agencyTelephone").val("")}),$("#agencyMessage").blur(function(){var e="agencyMessage";$("#agencyMessage").val().length>6?new u({context:$("body"),message:"长度大于6"}).show():e="",agencyErr.agencyMessage=e}),$("#agencyModel").on("blur",function(e){var n=$("#agencyModel").val();$("#agencyModel").attr("realVal",n);var a="agencyModel";n.length>0&&n.length<=50&&!pattern.test(n)?(r("#agencyModel",".agency-product-model"),a=""):""==n?($("#agencyModel").val(""),r("#agencyModel",".agency-product-model"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符"}).show(),t("#agencyModel",".agency-product-model")):(new u({context:$("body"),message:"产品型号至多50个字"}).show(),t("#agencyModel",".agency-product-model")),agencyErr.agencyModel=a,o()}),$("#agencyModel").focus(function(){r("#agencyModel",".agency-product-model"),$("#agencyModel").val($("#agencyModel").attr("realVal"))}),$("#agencyNumber").on("blur",function(e){var n=$("#agencyNumber").val();$("#agencyNumber").attr("realVal",n);var a="agencyNumber";n.length>0&&n.length<=4&&numberReg.test(n)?(r("#agencyNumber",".agency-number"),a=""):""==n?($("#agencyNumber").val(""),r("#agencyNumber",".agency-number"),a=""):(new u({context:$("body"),message:"购买数量至多4个或只能输入数字"}).show(),t("#agencyNumber",".agency-number")),agencyErr.agencyNumber=a,o()}),$("#agencyNumber").focus(function(){r("#agencyNumber",".agency-number"),$("#agencyNumber").val($("#agencyNumber").attr("realVal"))}),$("#agencyRemark").on("blur",function(e){var n=$("#agencyRemark").val();$("#agencyRemark").attr("realVal",n);var a="agencyRemark";n.length>0&&n.length<=200&&!pattern.test(n)?(r("#agencyRemark",".agency-remark"),a=""):""==n?($("#agencyRemark").val(""),r("#agencyRemark",".agency-remark"),a=""):pattern.test(n)?(new u({context:$("body"),message:"含有非法字符且长度大于200"}).show(),t("#agencyRemark",".agency-remark")):(new u({context:$("body"),message:"备注至多200个字"}).show(),t("#agencyRemark",".agency-remark")),agencyErr.agencyRemark=a,o()}),$("#agencyRemark").focus(function(){r("#agencyRemark",".agency-remark"),$("#agencyRemark").val($("#agencyRemark").attr("realVal"))}),$(".submits").click(function(){if(5!==i&&6!==i)new u({context:$("body"),message:"商品状态/你的身份不为空"}).show();else if(2==agency&&!$(this).hasClass("disabled")){$("#agencyConsumer").blur(),$("#agencyPhone").blur(),$("#agencyAddress").blur(),$("#agencyName").blur(),$("#agencyTelephone").blur(),$("#agencyModel").blur(),$("#agencyNumber").blur(),$("#agencyRemark").blur(),$("#agencyMessage").blur();var a=!1;for(var r in agencyErr)agencyErr[r]&&(a=!0);if(a){new u({context:$("body"),message:"数据有误"}).show();for(var r in agencyErr)agencyErr[r]=""}else{var t=$(this);$(this).addClass("disabled");var c={};window.type="","yes"==isSold&&(type="0"),"no"==isSold&&(2==agency&&6==i?type="1":2==agency&&5==i&&(type="2")),e(function(e){c=$("#agency-content:visible").length?{labelCode:n(labelCode,e),consumerName:n($("#agencyConsumer").val(),e),consumerMobile:n($("#agencyPhone").val(),e),consumerAddress:n($("#agencyAddress").val(),e),captcha:n($("#agencyMessage").val(),e),sellerName:n($("#agencyName").val(),e),sellerMobile:n($("#agencyTelephone").val(),e),standard:n($("#agencyModel").val(),e),quantity:n($("#agencyNumber").val(),e),remark:n($("#agencyRemark").val(),e),type:n(type,e)}:{labelCode:n(labelCode,e),consumerName:n($("#writeName").val(),e),consumerMobile:n($("#writeNumber").val(),e),consumerAddress:n($("#writeAddress").val(),e),captcha:n($("#writeCode").val(),e),standard:n($("#writeProduct").val(),e),quantity:n($("#writeNum").val(),e),remark:n($("#writeMore").val(),e),type:n(type,e)},$.ajax({type:"POST",url:s+"/wpservice/device/install29",async:!0,data:c,timeout:1e4,success:function(e){if(t.removeClass("disabled"),e.success)$(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#agency-content").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loading").show(),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/enterSuccess.png"),$(".middle p").html("登记成功");else{var n=e.errMsg;new u({context:$("body"),message:n}).show()}},error:function(e,n,a){"timeout"==n&&new u({context:$("body"),message:"网络超时"}).show(),t.removeClass("disabled")}})}),o()}}})});